/**
 * Copyright JS Foundation and other contributors, http://js.foundation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 **/

module.exports = function(RED) {
    // 定义节点构造函数
    function CustomFunctionNode(config) {
        // 初始化节点
        RED.nodes.createNode(this, config);
        var node = this;

        // 节点接收消息时的处理逻辑
        node.on('input', function(msg) {
            // 自定义处理逻辑（示例：在 payload 前添加前缀）
            if (msg.payload) {
                msg.payload = `[custom] ${msg.payload}`;
            }
            // 发送处理后的消息
            node.send(msg);
        });

        // 节点关闭时的清理逻辑
        node.on('close', function() {
            // 可选：释放资源、取消定时器等
        });
    }

    // 注册节点类型（第一个参数为节点类型名，需唯一）
    RED.nodes.registerType("custom-function", CustomFunctionNode);
};