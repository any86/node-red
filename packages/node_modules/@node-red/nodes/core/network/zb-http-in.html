<script type="text/html" data-template-name="zb-http-in">
 <zb-http-in id="zb-http-in"></zb-http-in>
</script>

<script type="text/javascript">
    (function () {
        const formData = {}
        function onChange(e) {
            Object.assign(formData, { ...e.target.value })
        }

        const DEFAULTS = {
            name: { value: "请求开始" },
            url: {
                value: "", required: true,
                label: RED._("node-red:httpin.label.url")
            },
            method: { value: "get", required: true },
            upload: { value: false },
            skipBodyParsing: { value: false },
            // swaggerDoc: {type:"swagger-doc", required:false}
        }

        RED.nodes.registerType('zb-http-in', {
            category: '坐标软件',
            color: "rgb(1, 255, 174)",
            defaults: DEFAULTS,
            inputs: 0,
            outputs: 1,
            icon: "zb-http-in.jpg",
            paletteLabel: '请求开始',
            label: function () {
                if (this.name) {
                    return this.name;
                } else if (this.url) {
                    var root = RED.settings.httpNodeRoot;
                    if (root.slice(-1) != "/") {
                        root = root + "/";
                    }
                    if (this.url.charAt(0) == "/") {
                        root += this.url.slice(1);
                    } else {
                        root += this.url;
                    }
                    return "[" + this.method + "] " + root;
                } else {
                    return "http";
                }
            },
            labelStyle: function () {
                return this.name ? "node_label_italic" : "";
            },

            oneditsave() {
                console.log(node);
                const node = this;
                node.url = formData.url
                alert('done')
            },


            oneditprepare: function () {
                const node = this
                console.log(`oneditprepare`);
                const zbHttpInComponent = document.getElementById("zb-http-in")
                zbHttpInComponent.value = this
                zbHttpInComponent.addEventListener('change',onChange)

                var root = RED.settings.httpNodeRoot;
                console.log(root);
                // if (root.slice(-1) == "/") {
                //     root = root.slice(0,-1);
                // }
                // if (root == "") {
                //     $("#node-input-tip").hide();
                // } else {
                //     $("#node-input-path").html(root);
                //     $("#node-input-tip").show();
                // }
                // if(!RED.nodes.getType("swagger-doc")){
                //     $('.row-swagger-doc').hide();
                // }
                // $("#node-input-method").on("change", function() {
                //     var method = $(this).val();
                //     if(["post", "put", "patch","delete"].includes(method)){
                //         $("#form-reqBody-http-in-controller").show();
                //         $("#form-row-http-in-parsing").show();
                //         if (method === "post") {
                //             $("#form-row-http-in-upload").show();
                //         } else {
                //             $("#form-row-http-in-upload").hide();
                //         }
                //     } else {
                //         $("#form-row-http-in-parsing").hide();
                //         $("#form-row-http-in-upload").hide();
                //         $("#form-reqBody-http-in-controller").hide();
                //     }
                // }).change();
            }
        });

    })();
</script>